function flr(a){return Math.floor(a)}function now(){return Date.now()}function abs(a){return Math.abs(a)}function V(a,b){return new Vec(a,b)}function font(a){return a+"px Impact, Charcoal, sans-serif"}function circle(a,b,c,d){a.beginPath(),a.arc(b,c,d,0,2*Math.PI,!1),a.closePath()}function gradient(a,b,c,d,e,f,g,h,i){var j=a.createRadialGradient(b,c,d,e,f,g);return j.addColorStop(0,h),j.addColorStop(1,i),j}function drawBG(a){var b=document.createElement("canvas"),c=b.getContext("2d");switch(b.width=352,b.height=240,a){case"Grid":c.fillStyle="rgb(20,20,20)",c.fillRect(0,0,352,240),c.lineWidth=.5,c.strokeStyle="green";for(var d=0;d<23;++d)drawLine(c,16*d,0,16*d,240);for(var d=0;d<16;++d)drawLine(c,0,16*d,352,16*d);break;case"Sky":c.fillStyle=gradient(c,200,400,200,200,300,300,"blue","cornflowerblue"),c.fillRect(0,0,352,240),c.beginPath(),c.moveTo(0,175),c.quadraticCurveTo(240,150,352,170),c.lineTo(352,240),c.lineTo(0,240),c.closePath(),c.fillStyle=gradient(c,200,200,50,200,180,200,"green","darkgreen"),c.fill();break;case"Night":c.fillStyle=gradient(c,200,400,200,200,300,300,"purple","blue"),c.fillRect(0,0,352,240),c.beginPath(),c.moveTo(0,170),c.quadraticCurveTo(200,140,352,175),c.lineTo(352,240),c.lineTo(0,240),c.closePath(),c.fillStyle=gradient(c,200,200,50,200,180,200,"darkgreen","rgb(10,70,10)"),c.fill()}return b}function drawLine(a,b,c,d,e){a.beginPath(),a.moveTo(b,c),a.lineTo(d,e),a.closePath(),a.stroke()}function DrawSpriteSheets(){var a={};for(var b in{dirt:1,guy:2,grid:3}){var c=document.createElement("canvas"),d=c.getContext("2d");c.width=256,c.height=128,d.fillStyle="black",DrawSprite(a,b,d,c),a[b].canvas=c}return a}function DrawSprite(a,b,c,d){a[b]={shapes:[]};var g,e=art[b+"P"],f="";switch(b){case"guy":var h=shape("guy");for(m=0;m<5;m++){c.drawImage(h,24*m+8,8);var i=shape("gun",m),j=art.gunO[m];c.drawImage(i,24*m+j[0],0+j[1]),c.save(),c.translate(24*(m+1)+24*m,0),c.scale(-1,1),c.drawImage(d,24*m,0,24,24,24*m,24,24,24),c.restore(),a[b].shapes.push({x:24*m,y:0,w:24,h:24}),a[b].shapes.push({x:24*m,y:24,w:24,h:24})}break;case"dirt":case"grid":for(var k=32,l=0;l<3;l++)for(var m=0;m<3;m++){g=c.getImageData(8*m,8*l,8,8);for(var n=0;n<8;n++)for(var o=0;o<8;o++)if(f=db32[e[art[b][n+4*l][o+4*m]]])for(var p=0;p<4;p++)g.data[4*(o+8*n)+p]=f[p]||255;c.putImageData(g,8*m,8*l)}for(var p=0,q=shapes.length;p<q;p++){for(var r=shapes[p],s={x:k,y:0,w:8*r[0],h:8*r[1]},o=0;o<r[0];o++)for(var n=0;n<r[1];n++){var t={};0===n?t.y=0:n<r[1]-1?t.y=1:t.y=2,0===o?t.x=0:o<r[0]-1?t.x=1:t.x=2,c.drawImage(d,8*t.x,8*t.y,8,8,8*o+k,8*n,8,8)}a[b].shapes.push(s),k+=8*r[0]}}}function shape(a,b){var j,c=document.createElement("canvas"),d=c.getContext("2d"),e=art[a][b]||art[a],f=e[0].length,g=e.length,h=d.createImageData(f,g),i=art[a+"P"];c.width=f,c.height=g;for(var k=0;k<g;k++)for(var l=0;l<f;l++)if(j=db32[i[e[k][l]]])for(var b=0;b<4;b++)h.data[4*(l+k*f)+b]=j[b]||255;return d.putImageData(h,0,0),c}function SfxrParams(){this.setSettings=function(a){for(var b=0;b<24;b++)this[String.fromCharCode(97+b)]=a[b]||0;this.c<.01&&(this.c=.01);var c=this.b+this.c+this.e;if(c<.18){var d=.18/c;this.b*=d,this.c*=d,this.e*=d}}}function SfxrSynth(){this._params=new SfxrParams;var a,b,c,d,e,f,g,h,i,j,k,l;this.reset=function(){var a=this._params;d=100/(a.f*a.f+.001),e=100/(a.g*a.g+.001),f=1-a.h*a.h*a.h*.01,g=-a.i*a.i*a.i*1e-6,a.a||(k=.5-a.n/2,l=5e-5*-a.o),h=1+a.l*a.l*(a.l>0?-.9:10),i=0,j=1==a.m?0:(1-a.m)*(1-a.m)*2e4+32},this.totalReset=function(){this.reset();var d=this._params;return a=d.b*d.b*1e5,b=d.c*d.c*1e5,c=d.e*d.e*1e5+12,3*((a+b+c)/3|0)},this.synthWave=function(m,n){var o=this._params,p=1!=o.s||o.v,q=o.v*o.v*.1,r=1+3e-4*o.w,s=o.s*o.s*o.s*.1,t=1+1e-4*o.t,u=1!=o.s,v=o.x*o.x,w=o.g,x=o.q||o.r,y=o.r*o.r*o.r*.2,z=o.q*o.q*(o.q<0?-1020:1020),A=o.p?((1-o.p)*(1-o.p)*2e4|0)+32:0,B=o.d,C=o.j/2,D=o.k*o.k*.01,E=o.a,F=a,G=1/a,H=1/b,I=1/c,J=5/(1+o.u*o.u*20)*(.01+s);J>.8&&(J=.8),J=1-J;for(var Q,S,U,W,Y,Z,K=!1,L=0,M=0,N=0,O=0,P=0,R=0,T=0,V=0,X=0,$=0,_=new Array(1024),aa=new Array(32),ba=_.length;ba--;)_[ba]=0;for(var ba=aa.length;ba--;)aa[ba]=2*Math.random()-1;for(var ba=0;ba<n;ba++){if(K)return ba;if(A&&++X>=A&&(X=0,this.reset()),j&&++i>=j&&(j=0,d*=h),f+=g,d*=f,d>e&&(d=e,w>0&&(K=!0)),S=d,C>0&&($+=D,S*=1+Math.sin($)*C),S|=0,S<8&&(S=8),E||(k+=l,k<0?k=0:k>.5&&(k=.5)),++M>F)switch(M=0,++L){case 1:F=b;break;case 2:F=c}switch(L){case 0:N=M*G;break;case 1:N=1+2*(1-M*H)*B;break;case 2:N=1-M*I;break;case 3:N=0,K=!0}x&&(z+=y,U=0|z,U<0?U=-U:U>1023&&(U=1023)),p&&r&&(q*=r,q<1e-5?q=1e-5:q>.1&&(q=.1)),Z=0;for(var ca=8;ca--;){if(T++,T>=S&&(T%=S,3==E))for(var da=aa.length;da--;)aa[da]=2*Math.random()-1;switch(E){case 0:Y=T/S<k?.5:-.5;break;case 1:Y=1-T/S*2;break;case 2:W=T/S,W=6.28318531*(W>.5?W-1:W),Y=1.27323954*W+.405284735*W*W*(W<0?1:-1),Y=.225*((Y<0?-1:1)*Y*Y-Y)+Y;break;case 3:Y=aa[Math.abs(32*T/S|0)]}p&&(Q=R,s*=t,s<0?s=0:s>.1&&(s=.1),u?(P+=(Y-R)*s,P*=J):(R=Y,P=0),R+=P,O+=R-Q,O*=1-q,Y=O),x&&(_[V%1024]=Y,Y+=_[(V-U+1024)%1024],V++),Z+=Y}Z*=.125*N*v,m[ba]=Z>=1?32767:Z<=-1?-32768:32767*Z|0}return n}}function Vec(a,b){return this.x=a||0,this.y=b||0,this}function Game(a){function w(a){if(u=n(w),!(a<e+j)){for(d+=a-e,e=a,q(b,a,d),a>g+1e3&&(f=.25*h+.75*f,g=a,h=0),h++,i=0;d>=c;)if(r(b,c),d-=c,++i>=240){m=!0;break}s(b,d/c),t(b,f,m),m=!1}}var b=this;this.init(a);var u,c=1e3/60,d=0,e=0,f=60,g=0,h=0,i=0,j=0,k=!1,l=!1,m=!1,n=server?function(){var b,d,a=Date.now();return function(e){return b=Date.now(),d=Math.max(0,c-(b-a)),a=b+d,setTimeout(function(){e(b+d)},d)}}():window.requestAnimationFrame,o=server?clearTimeout:window.cancelAnimationFrame,p=function(){},q=p,r=p,s=p,t=p,v={setBegin:function(a){return q=a||q,this},setUpdate:function(a){return r=a||r,this},setDraw:function(a){return s=a||s,this},setEnd:function(a){return t=a||t,this},start:function(){return l||(l=!0,u=n(function(a){s(b,1),k=!0,e=a,g=a,h=0,u=n(w)})),this},stop:function(){return k=!1,l=!1,o(u),this},isRunning:function(){return k}};this.mainLoop=v,v.setBegin(this.begin),v.setUpdate(this.update),server||v.setDraw(this.render),v.setEnd(this.end),v.start()}function newExplosion(a){var b=new Actor({game:a});return b.game=a,b.type="Explosion",b.visible=!1,b.fillStyle="white",b.explode=function(b){this.x=b.x-10,this.y=b.y-10,this.w=2,this.h=2,this.alpha=1,this.visible=!0,a.activeExplosions.push(this)},b.update=function(b){this.alpha*=.9,this.x-=.05*this.w,this.y-=.05*this.h,this.w*=1.1,this.h*=1.1,this.alpha<.1&&(a.activeExplosions.splice(a.activeExplosions.indexOf(this),1),a.explosions.push(this))},b}function newPlayer(a){var b=new Actor(a);switch(b.speed=300,b.accel=3,b.gravity=.01,b.moveVec=V(.3,0),b.type){case"Player":b.fI=300;break;case"Enemy":b.id=npID++,b.game.bullets[b.id]={},b.fI=600,b.health=a.health||1}b.grounded=!1,b.jP=40,b.jT=.12,b.jTr=b.jT,b.pInp=[],b.lastInput=-1,b.flipped=!1,b.flip=!1,b.fired=!1,b.fT=0,b.fV=V(),b.fS=12,b.tempVec=V(),b.connected=!0,b.damaged=!1,b.wins=0,b.dead=!1;var c=b.update;return b.update=function(a){c(a,this),"Player"===this.type,this.damaged&&Date.now()>this.damaged&&(this.damaged=!1),this.damaged?this.alpha=.2:this.alpha=1,this.fired&&Date.now()>this.fT+this.fI&&(this.fired=!1),"Enemy"!==this.type||this.dead||(this.vel.y>3&&!this.flip&&(this.flip=!0,this.vel.x*=Math.random()>.5?-1:1),this.vel.y<.3&&(this.flip=!1),this.vel.x+=this.moveVec.x*(1/a),this.pos.dis(this.game.player)<100&&(this.fV.copy(this.game.player.pos),this.tempVec.copy(this.game.player.pos).sub(this.pos),this.tempVec.mag()>100&&(Math.abs(this.tempVec.x)>50&&(this.tempVec.x>0?this.fV.x-=this.game.w:this.fV.x+=this.game.w),Math.abs(this.tempVec.y)>50&&(this.tempVec.y>0?this.fV.y-=this.game.h:this.fV.y+=this.game.h)),this.fV.sub(this.pos).normalize().scl(this.fS),b.fireBullet({}))),server||this.aimWeapon()},b.aimWeapon=function(){this.rL.copy(this.pos).sub({x:8,y:8});var a=this.game.assets[this.style].shapes;switch(this.fV.octDir()){case 0:this.shp=a[5];break;case 1:this.shp=a[7];break;case 2:this.shp=this.flipped?a[8]:a[9];break;case 3:this.shp=a[6];break;case 4:case-4:this.shp=a[4];break;case-3:this.shp=a[2];break;case-2:this.shp=this.flipped?a[0]:a[1];break;case-1:this.shp=a[3]}},b.fireBullet=function(a){this.fired||(this.game.addBullet({x:this.x+4,y:this.y+4,vel:this.fV,fT:Date.now(),id:a.inputSeq||0,parent:this}),this.fT=Date.now(),this.fired=!0)},b.takeDamage=function(a,b){if(server||(this===this.game.player?Sfx.play("hurt",.5,!1):Sfx.play("hit",.5,!1)),!this.dead){if(this.health-=a,this.health<=0)switch(this.dead=!0,this.type){case"Player":server||(this===this.game.player?Sfx.play("died",.5,!1):Sfx.play("kill",.4,!1)),this.game.deadPlayers++,this.game.singlePlayer&&this.game.matchOver();break;case"Enemy":server||Sfx.play("kill",.4,!1),this.game.explosions.pop().explode({x:this.pos.x,y:this.pos.y}),this.vel.clear(),this.gravity=.01,this.game.deadEnemies++;var c=this;setTimeout(function(){c.visible=!1},2e3)}this.vel.add(b.normalize().scl(5)),this.damaged=Date.now()+100}},b.applyInput=function(a,b){if(a.c&&this.jTr>0){var c=a.c<this.jTr?a.c:this.jTr;this.vel.y-=c*this.jP,b||server||this.jTr!==this.jT||Sfx.play("jump",.5,!1),this.jTr-=a.c}a.xAxis?(this.vel.x+=a.xAxis*this.accel,(this.vel.x<0&&a.xAxis>0||this.vel.x>0&&a.xAxis<0)&&(this.vel.x*=.95),a.xAxis<0?this.flipped=!0:this.flipped=!1):this.grounded&&(this.vel.x*=.95),this.fired||(this.fV.clear(),a.xAxis&&a.yAxis?(this.fV.x+=a.xAxis>0?this.fS:-this.fS,this.fV.y+=a.yAxis>0?this.fS:-this.fS):a.xAxis?this.fV.x+=a.xAxis>0?2*this.fS:2*-this.fS:a.yAxis?this.fV.y+=a.yAxis>0?2*this.fS:2*-this.fS:this.fV.x+=this.flipped?2*-this.fS:2*this.fS,a.v&&(this.fireBullet(a),Sfx&&Sfx.play("fire",.2,!1))),b&&this.applyMovement()},b.respondToCollision=function(a){if("Hidey"!==a.otherShape.type){switch(a.collisionSide){case"top":this.grounded=!0,this.jTr=this.jT;case"bottom":this.vel.y=0;break;case"left":this.vel.x>0&&(this.vel.x=0),this.moveVec.x=-1;break;case"right":this.vel.x<0&&(this.vel.x=0),this.moveVec.x=1}this.pos.add(a),this.game.constrainToScreen(this)}},b}function Actor(a){a=a||{},this.pos=V(a.x,a.y),this.w=a.w||0,this.h=a.h||0,this.game=a.game,this.type=a.type||"Actor";var b=a.shp;if(!server&&b>=0){this.style=a.style;var c=this.game.assets[this.style];this.shp=c.shapes[b],this.img=c.canvas}this.rL=V(),this.vel=V(),this.mV=4,this.gravity=0,this.grounded=!1,this.visible=!0,this.alpha=1,this.fillStyle=a.fillStyle||"green",Object.defineProperties(this,{x:{get:function(){return this.pos.x},set:function(a){this.pos.x=a}},y:{get:function(){return this.pos.y},set:function(a){this.pos.y=a}}})}function bind(){socket.on("start",function(a){loadGame(a.players)}),socket.on("connect",function(){connected=!0}),socket.on("gameEnded",function(){connected=!1,game=null}),socket.on("error",function(){})}function loadGame(a){game=new Game({server:!1,canvas:canvas,draw:draw,assets:assets,socket:socket,players:a,bgB:bgB,bgC:bgC,off:off,scl:scl})}function init(){buttons=document.getElementsByTagName("button");for(var a=[function(){socket=null,loadGame([{id:1}])},function(){online&&!connected?(socket=io({upgrade:!1,transports:["websocket"]}),bind(),document.getElementsByTagName("h3")[0].innerHTML="waiting for other players...   why not invite a friend?"):window.open("http://holosim.herokuapp.com")}],b=0;b<buttons.length;b++)!function(a,b){a.addEventListener("click",b,!1)}(buttons[b],a[b])}var db32={0:[1,1,1],3:[102,57,49],4:[143,86,59],9:[153,229,80],10:[106,190,48],12:[75,105,47],14:[50,60,57],16:[48,96,130],18:[99,155,255],19:[95,205,228],20:[203,219,252],23:[132,126,135],25:[89,86,82]},art={dirtP:{1:10,2:12,3:3,4:4},dirt:[[,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,1,2,1,1,2,1,2,1,1,2,1,2,2,1],[,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[,3,3,4,3,3,3,3,3,3,3,3,3,3,3],[,3,3,3,3,3,3,3,3,4,3,3,3,3,3],[,3,3,3,3,4,3,3,3,3,3,3,3,3,3],[,3,4,3,3,3,3,3,3,3,3,3,3,4,3],[,3,3,3,3,3,3,3,3,3,3,4,3,3,3],[,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[,3,3,3,3,3,4,3,3,4,3,3,3,3,3],[,3,3,3,3,3,3,3,3,3,3,3,3,4,3],[,3,3,3,3,4,3,3,3,3,3,3,3,3,3],[,3,3,4,3,3,3,3,3,3,3,3,4,3,3],[,,3,3,3,3,3,3,3,3,4,3,3,3,,],[,,,3,3,3,3,3,3,3,3,3,3,,,],[,,,,,,,,,,,,,,,]],gridP:{1:0,2:9},grid:[[,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,2],[2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,2],[2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,2],[2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,2],[2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,2],[2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,2],[2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,2],[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],[2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,2],[2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,2],[,2,2,2,2,2,2,2,2,2,2,2,2,2,2]],guyP:{1:14,2:25,3:18,4:19,5:20},guy:[[,2,2,2,2,0],[3,4,5,5,4,2],[3,4,4,5,5,2],[3,4,4,4,4,2],[3,4,4,4,2,1],[,1,1,1,1],[,2,2,2,2,2],[,2,2,2,2,2],[,2,2,2,2,2],[,2,2,2,2,2],[,2,2,2,2,2],[,1,2,1,1,2],[,1,1,,1,1],[,1,1,,1,1],[,,1,,,1],[,,2,,,2]],gunO:[[9,5],[5,7],[3,13],[4,13],[10,15]],gunP:{1:16,2:12,3:23,4:9},gun:[[[,2,4],[1,3,3],[1,3,3],[1,3,3],[1,3,3],[1,3,3],[1,3,3],[1,3,3]],[[,4,,,,,],[2,3,3,,,,],[1,3,3,3,,,],[,1,3,3,3,,],[,,1,3,3,3],[,,,1,3,3,3],[,,,,1,3,3]],[[4,3,3,3,3,3,3,3],[2,3,3,3,3,3,3,3],[,1,1,1,1,1,1,1]],[[,,,,,3,3],[,,,,3,3,3],[,,,3,3,3,1],[,,3,3,3,1],[,3,3,3,1,,],[4,3,3,1,,,],[,2,1,,,,]],[[3,3,1],[3,3,1],[3,3,1],[3,3,1],[3,3,1],[3,3,1],[3,3,1],[4,2]]]},shapes=[[2,2],[3,2],[4,2],[2,3],[2,4],[6,2],[2,6],[4,6]],levels={level1:[{shp:5,x:10,y:6,style:"dirt"},{shp:2,x:8,y:13,style:"dirt"},{shp:4,x:10,y:20,style:"dirt"},{shp:5,x:6,y:27,style:"dirt"},{shp:6,x:0,y:20,style:"dirt"},{shp:7,x:20,y:0,dm:!0,style:"dirt"},{shp:5,x:19,y:28,dm:!0,style:"dirt"},{shp:5,x:19,y:18,dm:!0,style:"dirt"},{shp:2,x:0,y:9,style:"dirt"}],level2:[{shp:5,x:10,y:6,style:"dirt"},{shp:5,x:6,y:13,style:"dirt"},{shp:6,x:21,y:20,dm:!0,style:"dirt"},{shp:5,x:10,y:27,style:"dirt"},{shp:6,x:0,y:8,style:"dirt"},{shp:7,x:0,y:24,style:"dirt"},{shp:2,x:9,y:20,style:"dirt"}]},server="object"!=typeof window;if(!server){var synth=new SfxrSynth;window.jsfxr=function(a){synth._params.setSettings(a);var b=synth.totalReset(),c=new Uint8Array(4*((b+1)/2|0)+44),d=2*synth.synthWave(new Uint16Array(c.buffer,44),b),e=new Uint32Array(c.buffer,0,44);return e[0]=1179011410,e[1]=d+36,e[2]=1163280727,e[3]=544501094,e[4]=16,e[5]=65537,e[6]=44100,e[7]=88200,e[8]=1048578,e[9]=1635017060,e[10]=d,c.buffer};var Sfx=function(){function e(b,d){var e=jsfxr(d);a.decodeAudioData(e,function(a){c[b]=a})}var a,b,c={},d=!0;return{init:function(){a=new AudioContext,b=a.createGain(),b.connect(a.destination),e("kill",[3,,.2,.65,.41,.13,.039,.21,-.026,,.04,.74,.78,,.02,.64,.22,-.18,.98,.05,,.025,-.034,.5]),e("died",[3,,.22,.62,.48,.16,,.21,,,,.73,.81,,,.68,.22,-.19,1,,,,,.5]),e("hurt",[0,.05,.09,.02,.17,.33,,-.35,-.02,.014,.005,-.003,.04,.3,-.01,,.04,,1,,,.2,-.01,.5]),e("hit",[1,,.08,,.2,.7,,-.58,,,,.04,,,,,,,1,,,.15,,.5]),e("jump",[0,,.25,,.23,.3,,.21,,,,,,.04,,,,,.79,,,,,.5]),e("fire",[1,,.27,.13,.11,.93,.24,-.4,-.05,.05,.07,-.003,.03,.7,-.18,.01,.015,-.08,1,-.07,.03,.07,.09,.5]),Sfx.mute()},play:function(d,e,f){var h,g=null;return d in c&&(h=a.createGain(),h.gain.value=e||1,h.connect(b),g=a.createBufferSource(),g.loop=f||!1,g.buffer=c[d],g.connect(h),g.start(0)),g},mute:function(){d=!d,b.gain.value=d?0:2}}}();window.onload=function(){window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext&&Sfx.init()}}Vec.prototype={add:function(a){return this.x+=a.x,this.y+=a.y,this},sub:function(a){return this.x-=a.x,this.y-=a.y,this},mag:function(){return Math.abs(Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)))},dis:function(a){return Math.sqrt(Math.pow(a.x-this.x,2)+Math.pow(a.y-this.y,2))},scl:function(a){return this.x*=a,this.y*=a,this},inv:function(){return this.x*=-1,this.y*=-1,this},copy:function(a){return this.x=a.x,this.y=a.y,this},clone:function(){return new Vec(this.x,this.y)},clear:function(a){return this.x=0,this.y=0,this},normalize:function(){var a=this.mag();return 0!=a&&(this.x/=a,this.y/=a),this},octDir:function(){var a=this.clone().normalize(),b=Math.atan2(a.y,a.x)*(180/Math.PI);return Math.round(b/45)}};var unitSize=8;Game.prototype={init:function(a){var b=this;this.gameStartTime=Date.now(),this.startAt=Date.now()+3e3,this.pause=!0,this.netLatency=100,this.w=352,this.h=240,this.gw=this.w/8,this.gh=this.h/8,this.assets=a.assets,this.players={},this.playerCount=2,this.deadPlayers=0,this.winner=null,this.matchEnded=!1,this.gameEnded=!1,this.bullets={},this.response=V(0,0),this.knockBack=V(0,0),this.player=null;for(var c=0,d=a.players.length;c<d;c++){var e=newPlayer({game:this,w:8,h:16,type:"Player",style:"guy",fillStyle:"purple",shp:0});server?(e.socket=a.players[c].socket,e.id=e.socket.id.substr(2)):(e.id=a.players[c],null===a.socket?0===c&&(this.player=e):e.id===a.socket.id&&(this.player=e)),this.players[e.id]=e,this.bullets[e.id]={}}if(server){for(var c in this.players){var e=this.players[c];e.socket.on("input",function(a){b.serverReceiveInput(b,a)})}var f=function(){var a={time:b.gameTime(),bullets:{}};for(var c in b.players){var d=b.players[c],e=b.bullets[d.id],f={};a[d.socket.id.substr(2)]={x:d.pos.x,y:d.pos.y,pos:{x:d.pos.x,y:d.pos.y},fV:{x:d.fV.x,y:d.fV.y},vel:{x:d.vel.x,y:d.vel.y},lastInput:d.lastInput,connected:d.connected};for(var g in e){var h=e[g];f[h.id]={pos:{x:h.pos.x,y:h.pos.y},vel:{x:h.vel.x,y:h.vel.y},fT:h.fT}}a.bullets[d.id]=f,d.connected===!1&&delete b.players[d.id]}for(var c in b.players)b.players[c].socket.emit("state",a)};setInterval(f,50)}else{window.mobile=!1,"undefined"!=typeof window.orientation&&(mobile=!0,window.top.scrollTo(0,1)),this.off=a.off,this.scl=a.scl,this.cover=document.getElementById("cover"),this.cover.style.position="fixed",this.cover.style.left=10*this.w*this.scl+"px",this.bgB=a.bgB,this.bgC=a.bgC,this.bgB.width=352,this.bgB.height=240,this.bgT=0,this.bgI=0,this.bgCh=!0,this.bgB2=drawBG("Night"),this.socket=a.socket,this.canvas=a.canvas,this.draw=a.draw,this.resetKeys=function(){b.keyRight=!1,b.keyLeft=!1,b.keyUp=!1,b.keyDown=!1},this.resetKeys(),this.inputSeq=0,this.explosions=[];for(var c=0;c<10;c++)this.explosions.push(newExplosion(this));this.activeExplosions=[],null!==this.socket?(this.serverUpdates=[],this.serverTime=0,this.updateTime=0,this.socket.on("state",function(a){b.serverUpdates.push(a),b.serverTime=a.time,b.updateTime=Date.now()}),this.socket.on("ready",function(a){b.startAt=a.startAt}),this.socket.on("hit",function(a){var c=b.explosions.pop();c&&c.explode({x:a.x,y:a.y}),a.hurt&&(b.knockBack.copy(a.knockBack),b.players[a.hurt].takeDamage(1,b.knockBack)),a.damaged&&b.level[a.damaged].hit(a.time)}),this.socket.on("levelGlitch",function(a){var c=b.level[a.id];c.type=a.type,c.style=a.style,c.img=b.assets[c.style].canvas}),this.socket.on("matchEnd",function(a){b.pause=!0,b.matchEnded=!0,null!==a.winner&&(b.winner=a.winner,b.players[b.winner].wins++),a.gameEnded?(b.gameEnded=!0,setTimeout(function(){b.disconnect(),location.reload()},5e3)):setTimeout(function(){b.loadLevel()},2e3)}),this.upV=V(),this.inV=V(),this.disV=V()):this.singlePlayer=!0;var g=function(a){a=a||window.event,a.preventDefault(),39==a.keyCode?b.keyRight="keydown"==a.type:37==a.keyCode?b.keyLeft="keydown"==a.type:38==a.keyCode?b.keyUp="keydown"==a.type:40==a.keyCode?b.keyDown="keydown"==a.type:32==a.keyCode?b.keySpace="keydown"==a.type:67==a.keyCode?b.keyC="keydown"==a.type:86==a.keyCode&&(b.keyV="keydown"==a.type)};document.body.onkeydown=g,document.body.onkeyup=g,this.touches={},this.tStk=V(),this.tStk.id=0,this.stkV=V(),this.fBtn=V(.7*this.canvas.width,.9*this.canvas.height),this.fBtn.id=0,this.jBtn=V(.83*this.canvas.width,.7*this.canvas.height),this.jBtn.id=0;var h=function(a){a.preventDefault(),b.touches={},b.resetKeys();for(var c=0,d=a.touches.length;c<d;c++){var e=a.touches[c];b.touches[e.identifier]={x:e.clientX,y:e.clientY,id:e.identifier}}if(0!==b.tStk.id){var e=b.touches[b.tStk.id];if(e){b.stkV.copy(e).sub(b.tStk);var f=b.stkV.octDir();switch(f){case 0:b.keyRight=!0;break;case 1:b.keyRight=!0;case 2:b.keyDown=!0;break;case 3:b.keyDown=!0;case 4:case-4:b.keyLeft=!0;break;case-3:b.keyLeft=!0;case-2:b.keyUp=!0;break;case-1:b.keyUp=!0,b.keyRight=!0}}else b.tStk.id=0}if(0!==b.fBtn.id){var e=b.touches[b.fBtn.id];e||(b.fBtn.id=0,b.keyV=!1)}if(0!==b.jBtn.id){var e=b.touches[b.jBtn.id];e||(b.jBtn.id=0,b.keyC=!1)}for(var c in b.touches){var e=b.touches[c];0===b.tStk.id&&e.x<b.canvas.width/2&&(b.tStk.id=e.id,b.tStk.copy(e)),0===b.fBtn.id&&b.fBtn.dis(e)<64&&(b.fBtn.id=e.id,b.keyV=!0),0===b.jBtn.id&&b.jBtn.dis(e)<64&&(b.jBtn.id=e.id,b.keyC=!0)}};document.body.ontouchstart=h,document.body.ontouchmove=h,document.body.ontouchend=h}this.loadLevel()},loadLevel:function(){var a=this;server||(a.bgB2=drawBG(["Sky","Night","Grid"][flr(3*Math.random())])),a.bgCh=!0,this.startAt=Date.now()+3e3,this.matchEnded=!1,this.deadPlayers=0,this.winner=null,this.pause=!0;var b=[{x:10,y:4},{x:33,y:4}],c=0;for(var d in this.players){var e=this.players[d];e.dead=!1,e.x=8*b[c].x,e.y=8*b[c++].y,e.vel.clear(),e.health=5}this.grid=[];for(var f=0;f<this.h/8;f++){this.grid.push([]);for(var g=0;g<this.w/8;g++)this.grid[f].push(1)}this.level=[],this.lastGlitch=Date.now();for(var i=(flr(2*Math.random())+1,levels.level1),d=0,j=i.length;d<j;d++){var k=i[d],l=shapes[k.shp];this.level.push(this.newLevelPiece({game:a,x:k.x,y:k.y,w:l[0],h:l[1],type:k.type,fillStyle:k.fillStyle,shp:k.shp,style:k.style})),k.dm||this.level.push(this.newLevelPiece({game:a,x:a.w/8-k.x-l[0],y:k.y,w:l[0],h:l[1],type:k.type,fillStyle:k.fillStyle,shp:k.shp,style:k.style}))}this.enemies=[],this.deadEnemies=0,this.spawnTime=Date.now(),this.enemiesToSpawn=0,this.difficulty=1;for(var d=0,j=this.level.length;d<j;d++)this.level[d].id=d;if(this.hits=[],this.hit=V(),server)for(var d in this.players)this.players[d].socket.emit("ready",{startAt:this.startAt})},glitchLevel:function(){if((server||this.singlePlayer)&&Date.now()>this.lastGlitch+6e3){this.lastGlitch=Date.now();var a=this.level[flr(Math.random()*this.level.length)];if(a.type=["Hidey","Broken","Actor"][flr(3*Math.random())],a.style=["grid","dirt"][flr(2*Math.random())],server||(a.img=this.assets[a.style].canvas),server)for(var b in this.players)this.players[b].socket.emit("levelGlitch",{id:a.id,type:a.type,style:a.style})}},spawnEnemies:function(){this.enemies.length<this.enemiesToSpawn?Date.now()>this.spawnTime+5e3&&(this.enemies.push(newPlayer({game:this,x:256,y:8*[2,10,17,24][flr(4*Math.random())],w:8,h:16,type:"Enemy",style:"guy",shp:0,fillStyle:"orange"})),this.spawnTime=Date.now()):this.spawningEnemies=!1},newLevelPiece:function(a){for(var b=0;b<a.h;b++)for(var c=0;c<a.w;c++)this.grid[a.y+b][a.x+c]=0;a.x*=8,a.y*=8,a.w*=8,a.h*=8;var d=new Actor(a);d.visLength=2e3,d.visTime=0,d.update=function(a){switch(this.type){case"Broken":this.visible||Date.now()>this.visTime&&(this.visible=!0),this.rL.x=this.x+flr(2*Math.random())-1;case"Actor":this.alpha=1;break;case"Hidey":flr(this.game.gameTime()/1e4)%2===0&&(this.alpha=Math.random()/10+.6),this.rL.y=this.y+flr(2*Math.random())-1}};var e=d.render;return d.render=function(a){e(a,this)},d.hit=function(a){"Broken"===this.type&&this.visible&&(this.visTime=a||Date.now()+this.visLength,this.visible=!1)},d},gameTime:function(){return Date.now()-this.gameStartTime},matchOver:function(){if(this.pause=!0,this.singlePlayer){this.matchEnded=!0,this.gameEnded=!0;var a=localStorage.HoloSimHighScore;(!a||this.deadEnemies>a)&&(localStorage.HoloSimHighScore=this.deadEnemies);var b=this;return void setTimeout(function(){b.disconnect(),location.reload()},5e3)}this.winner=null;for(var c in this.players){var d=this.players[c];d.dead||(this.winner=d.id,d.wins++,3===d.wins&&(this.gameEnded=!0))}for(var c in this.players){var d=this.players[c];d.socket.emit("matchEnd",{winner:this.winner,gameEnded:this.gameEnded}),this.gameEnded&&(d.socket.emit("gameEnded"),delete this.players[c])}if(!this.gameEnded){var b=this;setTimeout(function(){b.loadLevel()},2e3)}},begin:function(a,b,c){if(server){!a.matchEnded&&a.deadPlayers>=a.playerCount-1&&(a.matchOver(),a.matchEnded=!0),a.serverProcessInput();for(var d in a.players)a.players[d].begin()}else a.player.begin(),a.singlePlayer||(a.syncClientsPlayer(),a.syncNetworkPlayers()),a.clientProcessInput(b)},update:function(a,b){function l(){for(var c in a.bullets)for(var d in a.bullets[c]){var e=a.bullets[c][d];if(e)if(Date.now()>e.fT+500)delete a.bullets[c][d];else{e.update(b);for(var f=0,g=a.level.length;f<g;f++)a.level[f].visible&&"Hidey"!==a.level[f].type&&e.collidesWith(a.level[f],a.response)&&(a.bulletHit(a.response),delete a.bullets[c][d]);for(var f=0,g=a.enemies.length;f<g;f++){var h=a.enemies[f];h.dead||h.id===e.parent.id||e.collidesWith(h,a.response)&&(a.bulletHit(a.response),delete a.bullets[c][d])}for(var f in a.players){var i=a.players[f];i.dead||i.id===e.parent.id||e.collidesWith(i,a.response)&&(a.bulletHit(a.response),delete a.bullets[c][d])}}}}!server&&a.bgCh&&a.changeBackground();for(var c=0,d=a.level.length;c<d;c++)a.level[c].update(b);if(!a.pause)for(var c=0,d=a.enemies.length;c<d;c++){var e=a.enemies[c];e.update(b);for(var f=0,g=a.level.length;f<g;f++){var h=a.level[f];h.visible&&e.collidesWith(h,a.response)&&e.respondToCollision(a.response)}}if(a.singlePlayer&&a.deadEnemies===a.enemiesToSpawn&&(a.enemiesToSpawn+=a.difficulty++,a.spawningEnemies=!0),a.spawningEnemies&&a.spawnEnemies(),a.glitchLevel(),server){l();for(var c in a.players){var i=a.players[c];i.update(b);for(var f=0,g=a.level.length;f<g;f++)a.level[f].update(b),a.level[f].visible&&i.collidesWith(a.level[f],a.response)&&i.respondToCollision(a.response)}}else{l();var j=a.player;j.update(b);for(var c=0,d=a.level.length;c<d;c++)a.level[c].update(b),a.level[c].visible&&j.collidesWith(a.level[c],a.response)&&j.respondToCollision(a.response);for(var c=0,d=a.activeExplosions.length;c<d;c++){var k=a.activeExplosions[c];k&&k.update(b)}}},bulletHit:function(a){if(server||this.singlePlayer){this.hit.copy(a.self.centre());var b=a.otherShape,c={x:this.hit.x,y:this.hit.y};if(!b.damaged){switch(b.type){case"Player":this.knockBack.copy(b.centre()).sub(a.self.centre()),this.players[b.id].takeDamage(1,this.knockBack),c.hurt=b.id,c.knockBack={x:this.knockBack.x,y:this.knockBack.y};break;case"Broken":b.hit(),c.damaged=b.id,c.time=b.visTime;break;case"Enemy":b.takeDamage(1,this.knockBack)}if(server)for(var d in this.players)this.players[d].socket.emit("hit",c);this.singlePlayer&&this.explosions.pop().explode({x:this.hit.x,y:this.hit.y})}}},render:function(a,b){a.bgCh||a.draw.clearRect(0,0,a.canvas.width,a.canvas.height),a.draw.save(),a.draw.translate(a.off.x,a.off.y),a.draw.scale(a.scl,a.scl),a.draw.beginPath(),a.draw.rect(0,0,a.w,a.h),a.draw.closePath(),a.draw.clip(),a.draw.drawImage(a.bgB,0,0);for(var c in a.players){var d=a.players[c];d.render(a.draw),d===a.player&&(circle(a.draw,d.x+4,d.y-4,2),a.draw.fillStyle="orange",a.draw.fill());for(var e in a.bullets[c])a.bullets[c][e]&&a.bullets[c][e].render(a.draw)}for(var c=0,f=a.enemies.length;c<f;c++){var g=a.enemies[c];g.render(a.draw);for(var e in a.bullets[g.id])a.bullets[g.id][e]&&a.bullets[g.id][e].render(a.draw)}for(var c=0,f=a.level.length;c<f;c++)a.level[c].render(a.draw);for(var c=0,f=a.activeExplosions.length;c<f;c++){var h=a.activeExplosions[c];h.render(a.draw)}for(var c=0;c<a.player.health;c++)circle(a.draw,16*(c+1),8,4),a.draw.fillStyle="orange",a.draw.fill(),a.draw.fillStyle="black",a.singlePlayer||a.draw.fillText("Player: "+a.player.id.substr(0,6),96,12);if(a.pause){if(a.draw.fillStyle="black",Date.now()<a.startAt&&(a.draw.font=font(30),a.draw.fillText("Starting in: "+(a.startAt-Date.now())/1e3,80,100)),a.matchEnded&&!a.gameEnded){a.draw.font=font(50),a.draw.fillText("Match Ended",50,50);var i=0;a.draw.font="18px arial";for(var c in a.players)a.draw.fillText(a.players[c].id.substr(0,6)+": "+a.players[c].wins,10,100+20*i++)}if(a.gameEnded)if(a.draw.font=font(50),a.draw.fillText("Game Over",50,50),a.draw.font="18px arial",a.singlePlayer)a.draw.fillText("You killed "+a.deadEnemies+" enemies!",75,100),a.draw.fillText("High score: "+localStorage.HoloSimHighScore,75,150);else{var i=0;for(var c in a.players)c===a.winner&&a.draw.fillText("WINNER",100,100+20*i),a.draw.fillText(a.players[c].id.substr(0,6)+": "+a.players[c].wins,10,100+20*i++)}}a.draw.restore(),mobile&&(0!==a.tStk.id&&(circle(a.draw,a.tStk.x,a.tStk.y,64),a.draw.fillStyle="rgba(0,0,0,0.1)",a.draw.fill(),circle(a.draw,a.touches[a.tStk.id].x,a.touches[a.tStk.id].y,64),a.draw.fill()),a.draw.fillStyle="rgba(0,0,0,0.2)",circle(a.draw,a.fBtn.x,a.fBtn.y,64),a.draw.fill(),circle(a.draw,a.jBtn.x,a.jBtn.y,64),a.draw.fill())},end:function(a,b,c){for(var d in a.players)a.players[d].end()},disconnect:function(a){server?this.players[a]&&(this.players[a].connected=!1):(this.mainLoop.stop(),this.draw.clearRect(0,0,this.canvas.width,this.canvas.height),this.cover.style.left="0px")},syncClientsPlayer:function(){for(var a=0,b=this.serverUpdates.length;a<b;a++){var c=this.serverUpdates[a],d=c[this.socket.id];if(c&&!c.checked){c.checked=!0,this.player.lastInput=d.lastInput;for(var e=0;e<this.player.pInp.length;){var f=this.player.pInp[e],g=0;f.inputSeq<=this.player.lastInput?(f.inputSeq===this.player.lastInput&&(this.upV.copy(d),this.inV.copy(f.pos),g=this.upV.dis(this.inV),g>2?this.player.pos.copy(this.upV):g>.01&&this.player.pos.add(this.upV.sub(this.inV).scl(.1)),this.player.vel.copy(d.vel)),this.player.pInp.splice(0,1)):(this.player.applyInput(f,!0),e++)}this.syncBullets(c.bullets)}}},syncNetworkPlayers:function(){for(var a=this.serverTime+(Date.now()-this.updateTime)-this.netLatency,b=null,c=null,d=null,e=0,f=-1,g=0,h=this.serverUpdates.length-1;g<h;g++){var b=this.serverUpdates[g],c=this.serverUpdates[g+1];if(this.serverTime-b.time>1e4)f=g;else if(a>=b.time&&a<c.time)break}if(b&&c){e=(a-b.time)/(c.time-b.time);for(var g in this.players)d=this.players[g],d&&d.id!==this.player.id&&void 0!==c[d.id]&&void 0!==b[d.id]&&(b[d.id].connected!==!1&&c[d.id].connected!==!1?(this.inV.copy(b[d.id]),this.upV.copy(c[d.id]),this.disV.copy(this.upV).sub(this.inV),this.inV.dis(this.upV)>64?d.pos.copy(this.upV).sub(this.disV.scl(1/e)):d.pos.copy(this.inV).add(this.disV.scl(e)),d.fV.copy(b[d.id].fV),d.aimWeapon()):delete this.players[d.id])}f>=0&&this.serverUpdates.splice(0,f+1)},clientProcessInput:function(a){var b=this.player,c=Date.now(),d=this.last_ts||c,e=(c-d)/1e3;if(this.last_ts=c,this.pause)return void(!this.matchEnded&&Date.now()>this.startAt&&(this.pause=!1));if(!b.dead){var f={pos:b.pos,vel:b.vel};this.keyRight&&(f.xAxis=e),this.keyLeft&&(f.xAxis=-e),this.keyUp&&(f.yAxis=-e),this.keyDown&&(f.yAxis=e),this.keySpace&&(f.space=!0),this.keyC&&(f.c=e),this.keyV&&(f.v=e),f.inputSeq=this.inputSeq++,f.playerID=b.id,f.time=c,this.singlePlayer||(this.socket.emit("input",f),this.player.pInp.push(f)),this.player.applyInput(f)}},serverReceiveInput:function(a,b){a.players[b.playerID]&&a.players[b.playerID].pInp.push(b)},serverProcessInput:function(){for(var a in this.players){for(var b=this.players[a],c=0,d=b.pInp.length;c<d;c++){var e=b.pInp[c];b.applyInput(e),b.lastInput=e.inputSeq}b.pInp=[]}},syncBullets:function(a){for(var b in a)if(b!==this.player.id)for(var c in a[b]){var d=a[b][c];this.bullets[b][c]||this.addBullet({x:d.pos.x,y:d.pos.y,vel:d.vel,fT:d.fT,id:c,parent:this.players[b]})}},addBullet:function(a){var b=this,c=new Actor({game:b,x:a.x,y:a.y,w:4,h:4,type:"Bullet",fillStyle:"orange"});c.parent=a.parent,c.vel=V().copy(a.vel),c.fT=a.fT,c.id=a.id,c.render=function(a){circle(a,this.x,this.y,this.w/2),a.fillStyle="yellow",a.fill()},this.bullets[a.parent.id][a.id]=c},constrainToScreen:function(a){(a.x<0||a.x+a.w>this.w||a.y<0||a.y+a.h>this.h)&&(a.centreX()<0?a.x+=this.w:a.centreX()>this.w&&(a.x-=this.w),a.centreY()<0?a.y+=this.h:a.centreY()>this.h&&(a.y-=this.h))},changeBackground:function(){for(var a=0;a<5;a++){var b=this.bgI%26,c=flr(this.bgI/26);this.bgC.drawImage(this.bgB2,16*b,16*c,16,16,16*b,16*c,16,16),this.bgI++}390===this.bgI&&(this.bgCh=!1,this.bgI=0)}};var npID=2;if(Actor.prototype={begin:function(){},update:function(a,b){var b=b||this;b.vel.y+=a*b.gravity,
b.applyMovement(),b.game.constrainToScreen(b),b.grounded=!1},applyMovement:function(){this.game.gameEnded&&(this.vel.x*=.95),this.pos.add(this.vel),this.vel.x>.67*this.mV&&(this.vel.x=.67*this.mV),this.vel.x<.67*-this.mV&&(this.vel.x=.67*-this.mV),this.vel.y>this.mV&&(this.vel.y=this.mV),this.vel.y<-this.mV&&(this.vel.y=-this.mV)},render:function(a,b){var b=b||this,c=b.rL||{};a.save(),1!==b.alpha&&(a.globalAlpha=b.alpha),b.visible&&(void 0!==b.shp?a.drawImage(b.img,b.shp.x,b.shp.y,b.shp.w,b.shp.h,c.x||b.x,c.y||b.y,b.shp.w,b.shp.h):(a.fillStyle=b.fillStyle,a.fillRect(c.x||b.x,c.y||b.y,b.w,b.h))),a.restore()},end:function(){},halfWidth:function(){return this.w/2},halfHeight:function(){return this.h/2},centreX:function(){return this.x+this.halfWidth()},centreY:function(){return this.y+this.halfHeight()},centre:function(){return V(this.x+this.halfWidth(),this.y+this.halfHeight())},collidesWith:function(a,b){if(a){this.collisionObject&&b.clear(),b.x=0,b.y=0,b.self=this,b.otherShape=a;var d,e,f=this.centreX()-a.centreX(),g=this.centreY()-a.centreY(),h=this.halfWidth()+a.halfWidth(),i=this.halfHeight()+a.halfHeight();if(Math.abs(f)<h&&Math.abs(g)<i)return d=h-Math.abs(f),e=i-Math.abs(g),d>e?g>0?(b.collisionSide="bottom",b.y=e):(b.collisionSide="top",b.y=-e):f>0?(b.collisionSide="right",b.x=d):(b.collisionSide="left",b.x=-d),b}return!1}},!server){var socket=null,connected=!1,game=null,buttons,canvas=document.createElement("canvas"),draw=canvas.getContext("2d"),bgB=document.createElement("canvas"),bgC=bgB.getContext("2d"),assets=DrawSpriteSheets();canvas.width=window.innerWidth,canvas.height=window.innerHeight,canvas.style.position="fixed",canvas.style.top=0,canvas.style.left=0,canvas.style.zIndex=-1,bgB.width=352,bgB.height=240,draw.imageSmoothingEnabled=!1;var h=canvas.height,w=canvas.width,hs=h/240,ws=w/352,scl=hs<ws?hs:ws,tH=240*scl,tW=352*scl,off=new Vec((w-tW)/2,(h-tH)/2);draw.save(),draw.translate(off.x,off.y),draw.scale(scl,scl),draw.drawImage(drawBG("Grid"),0,0),draw.restore(),document.body.appendChild(canvas),window.addEventListener("load",init,!1)}